### Activity生命周期

- onCreate:在Activity整个生命周期中只调用一次
- onStart:
- onPause :表示Activity正在停止。在这里可以做一些储存数据，停止动画等工作，但不能太耗时，因为必须onPause执行完成之后新的Activity才能Resume。
- onStop :表示Activity即将停止。可以进行一些稍微重量级的回收工作，不能太耗时
- onDestroy :表示Activity即将被销毁。可以进行一些回收工作和最终的资源释放。
- 在内存严重不足时，onStop()不会被执行，但是onPause()是保证被执行的，因此数据的持久化保存在onPause()中来做。


#### 启动一个Activity

> onCreate() -> onStart() -> onResume() -> onAttachedToWindow() -> onWindowFocusChanged() -> onEnterAnimationComplete()

#### 结束一个Activity

> onPause() -> onStop() -> onDestroy()

#### 按下home键后再点击icon启动

> onPause() -> onSaveInstanceState() -> onStop() ->
> onRestart() -> onStart() -> onResume()

#### Activity A 启动 Activity B，然后按下返回键

> A:onCreate() -> A:onStart() -> A:onResume() ->
>
> A:onPause() -> B:onCreate() -> B:onStart() -> B:onResume() -> A:onStop() -> A:onSaveInstanceState() -> 
>
> B:onPause() -> A:onStart() -> A:onResume() -> B:onStop() -> B:onDestroy()

> **注意: A:onSaveInstanceState()方法也有可能在A:onStop()方法之前调用（7.1.1）上，上面所示是在9.0上的运行结果。**
>
> **还有，即使不在onSaveInstanceState()中做数据的存储和恢复，A中的数据也依然存在，但是在横竖屏切换时，如果没有在onSaveInstanceState()中做存储和恢复，那么数据就会丢失。**

### 如果在上述情况中Activity B是透明的呢，如果Activity A启动的是一个Dialog呢？

> Activity A不会调用onStop()方法，如果是Dialog，也不会调用onStop()方法。

### 如果启动一个在栈顶的singleTop/singltTask模式的Activity，或者启动一个singleTask模式的栈内Activity呢？

> singleTop/singleTask栈顶： onPause() –> onNewIntent() –> onResume() 
>
> singleTask栈内：此时处于onStop状态：[A.onStop()] –> A.onNewIntent() –> A.onRestart() –> A.onStart() –> A.onResume() 

#### Activity横竖屏切换

- 不设置**android:configChanges="screenSize|keyboardHidden|orientation"**

  >onCreate() -> onStart() -> onResume() ->
  >
  >onPause() -> onSaveInstanceState() -> onStop() -> onDestroy() -> onCreate() -> onStart() -> onRestoreInstanceState() -> onResume()

- 设置以后只会调用**onConfigurationChanged(@NonNull Configuration newConfig)**方法

---

### Fragment生命周期

> Activity:onCreate() -> Fragment:onAttach() -> Fragment:onCreate() -> Fragment:onCreateView() -> Fragment:onViewCreated() -> Fragment:onActivityCreated() -> Fragment:onStart() -> Activity:onStart() -> Activity:onResume() -> Fragment:onResume() ->
>
> Fragment:onPause() -> Activity:onPause() -> Fragment:onStop() -> Activity:onStop() -> Fragment:onDestroyView() -> Fragment:onDestroy() -> Fragment:onDetach() -> Activity:onDestroy()

![](C:\Projects\TinyTank\app\src\main\assets\QAndA\1-100\img\activity_fragment_lifecycle.png)

> 在启动时，Activity生命周期走在前（如：Activity:onCreate()先调用，然后才会调用Fragment:onCreate()），而在结束时，Fragment生命周期走在前面（如：Fragment:onPause()先调用，Activity:onPause()后调用）。
