### 通过setTheme

- 在attrs.xml中自定义属性

  ```xml
  <attr name="mainBackground" format="color|reference" />
  ```

- 在styles.xml中可以设置多个主题，在每个主题中必须引用上面定义好的属性

  ```xml
  <style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar">
      <item name="mainBackground">@android:color/white</item>
  </style>
  ```

  ```xml
  <style name="AppThemeNight" parent="Theme.AppCompat.Light.NoActionBar">
      <item name="mainBackground">@android:color/black</item>
  </style>
  ```

  ...

- 将该属性设置到相应的位置上去，在这里就是设置背景色

  ```xml
  <ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
          xmlns:app="http://schemas.android.com/apk/res-auto"
          xmlns:tools="http://schemas.android.com/tools"
          android:layout_width="match_parent"
          android:layout_height="match_parent"
          android:background="?attr/mainBackground">
  ```

- 在所有Activity的基类里面通过在**`setContentView()之前调用setTheme()`**来实现主题的设置。

  ```kotlin
  companion object {
      var currentTheme = MutableLiveData<Int>(R.style.AppTheme)
  }
  
  override fun onCreate(savedInstanceState: Bundle?) {
      super.onCreate(savedInstanceState)
      setTheme(currentTheme.value ?: R.style.AppTheme)
  }
  
  override fun onEnterAnimationComplete() {
      super.onEnterAnimationComplete()
      currentTheme.observe(this, Observer<Int> {
          Log.i("themeChanger", "observe: ${currentTheme.value}")
          recreate()
      })
  }
  ```

- 调用Activity的recreate()方法来使主生效。

  > 这个实现方式在大多数手机上都会闪屏，体验不好。在一加６上会闪屏(9.0)，在锤子坚果pro2上不会闪屏(7.1.1)。

---

