### 基础

> **只带有一个Context参数的构造函数用于代码中new一个View，其余三个用来在Xml中填充View**
>
> **以TextView为例，android:textColor这个属性可以在多个地方配置，可以直接写在xml中，可以在xml中以style的形式定义，这两种是我们平时见得较多的，其实还有一种背后的力量可以给属性赋值，那就是主题。**
>
> **View类的后两个构造函数都是与主题相关的，也就是说，在你自定义View时，如果不需要你的View随着主题变化而变化，有前两个构造函数就OK了，但是如果你想你的View随着主题变化而变化，就需要利用后两个构造函数了。**

---

### 构造函数


- 第一个构造方法用于在代码中`new` 一个`View`

  ```java
  public CustomizedView(Context context) {
  	super(context);
  }
  ```

- 第二个构造方法用于在 `xml` 中使用自定义的 `View` 

  ```java
  public CustomizedView(Context context, @Nullable AttributeSet attrs) {
  	super(context, attrs);
  }
  ```

- 第三个构造函数就是相对于第二个构造函数，通过 `deftStyleAttr`引用`主题`中设置的该View的属性， 如果没有默认的值，就用 0 。这样做的好处就是，我们可以默认一个 View 的基础风格。比如可以在 `defSyleAttr` 中设置背景颜色，字体大小等等基础风格，这样我们定义的这个 View 就有了原始风格了，当然如果你在 `xml` 中又设置了背景颜色，等于改变了原始的风格，是最优先于 `xml` 中的属性的。

  ```java
  public CustomizedView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
  	super(context, attrs, defStyleAttr);
  }
  ```

  其实我们使用的很多系统 View 都是通过这种方式来，这里用 `Button` 来举个例子：

  ```java
  public Button(Context context, AttributeSet attrs) {
      this(context, attrs, com.android.internal.R.attr.buttonStyle);
  }
  ```
  
  ```xml
  <!-- Normal Button Style. -->
  <attr name="buttonStyle" format="reference"/>
  ```
  
  ```xml
  <!-- 可以看到在系统的 Theme 中给 buttonSyle 赋值了,指向了 style/Widget.Holo.Light.Button.-->
  <item name="buttonStyle">@style/Widget.Holo.Light.Button</item>
  ```
  
  ```xml
  <!-- 这个风格就是主题中指定了的 Button 的默认风格，当然我们在定义主题的时候，也可以自己在主题中定义 buttonStyle 这个属性的值。-->
  <style name="Widget.Holo.Light.Button" parent="Widget.Button">
  	<item name="background">@drawable/btn_default_holo_light</item>
  	<item name="textAppearance">?attr/textAppearenceMediumInverse</item>
  	<item name="textColor">@color/primary_text_holo_light</item>
  	<item name="minHeight">48dip</item>
  	<item name="minWidth">64dip</item>
  </style>
  ```

- 第四个构造函数相对第三个构造函数就多了一个 `defStyleRes`  ，这种方式更加的简单，直接在代码中传入 `R.style.XX` 就可以了。如果没有默认值的话就为 0 。这个参数只有 `defStyleAttr` 为 0 的时候才会生效。

---

### 属性定义优先级

xml定义 > style > theme

---

  

https://blog.danlew.net/2016/07/19/a-deep-dive-into-android-view-constructors/

https://juejin.im/post/5d6676b5e51d4561a60d9e12